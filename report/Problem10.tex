First, we extend our model with two input disturbances such that the linear output will also show the second and third order harmonics. The new linearised model is
\begin{align*}
   \dot{\text{x}} &= A\text{x} + B\text{u} +B_d\text{d}, \qquad with\ d = [d_{i1}, d_{i2}].\\
   y &= C\text{x}
\end{align*}



We know that $d_{i1} = A_{i1}\sin(4\pi f_ct)$ and $d_{i2} = A_{i2}\sin(6\pi f_ct)$ but we have to determine the magnitudes $A_{i1}$ and $A_{i2}$. As this disturbance can be considered as an input, we choose to take $B_d = [B\ B]$ and to find the right magnitudes to use.

In order to find $A_{i1}$ and $A_{i2}$, we evaluate the gain of the transfer function for the three different frequencies. Then, knowing the desired amplitude for each harmonic, we can find the magnitudes $A_{i1}$ and $A_{i2}$.

\begin{lstlisting}[language=Matlab]
sys=ss(A,B,C,[0]);
w = [2:2:6]*pi*fc;
[MAG,PHASE] = bode(sys,w)
MAG=[MAG(1) MAG(2) MAG(3)];
[Aifundamental, Ai1, Ai2] = Amplitude(3,1:3)./MAG % = 5.0212    0.0723    0.0792
\end{lstlisting}